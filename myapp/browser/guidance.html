<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIS Realtime API - Developer Guide</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 3em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }

        .status-badge {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            white-space: nowrap;
            min-width: 120px;
        }

        .nav-tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .tab-content {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 2em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .section h3 {
            color: #34495e;
            margin: 25px 0 15px 0;
            font-size: 1.4em;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-card i {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .feature-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .code-block {
            background: #2d3748;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            position: relative;
        }

        .code-block::before {
            content: attr(data-language);
            position: absolute;
            top: 10px;
            right: 15px;
            background: #667eea;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .code-block pre {
            margin: 0;
            color: #e2e8f0;
        }

        .params-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .params-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .params-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        .params-table tr:hover {
            background: #f8f9fa;
        }

        .endpoint-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            word-break: break-all;
        }

        .demo-section {
            background: linear-gradient(135deg, #ffeaa7, #fab1a0);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }

        .demo-button {
            background: linear-gradient(45deg, #00b894, #00cec9);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            text-decoration: none;
            display: inline-block;
        }

        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid;
        }

        .alert-info {
            background: #e3f2fd;
            border-color: #2196f3;
            color: #1976d2;
        }

        .alert-warning {
            background: #fff3e0;
            border-color: #ff9800;
            color: #f57c00;
        }

        .alert-success {
            background: #e8f5e8;
            border-color: #4caf50;
            color: #388e3c;
        }

        .response-example {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .footer {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            margin-top: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .copy-button {
            position: absolute;
            top: 10px;
            right: 60px;
            background: #667eea;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .copy-button:hover {
            background: #5a6fd8;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }

            .tab-content {
                padding: 20px;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                margin-bottom: 5px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-ship"></i> AIS Realtime API</h1>
            <p>Server-Sent Events untuk Data Maritim Real-time</p>
            <span class="status-badge"><i class="fas fa-check-circle"></i> Live & Ready</span>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">
                <i class="fas fa-home"></i> Overview
            </button>
            <button class="nav-tab" onclick="showTab('quickstart')">
                <i class="fas fa-rocket"></i> Quick Start
            </button>
            <button class="nav-tab" onclick="showTab('parameters')">
                <i class="fas fa-cogs"></i> Parameters
            </button>
            <button class="nav-tab" onclick="showTab('response')">
                <i class="fas fa-code"></i> Response
            </button>
            <button class="nav-tab" onclick="showTab('examples')">
                <i class="fas fa-code-branch"></i> Examples
            </button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="section">
                <h2><i class="fas fa-info-circle"></i> API Overview</h2>
                <p>API Realtime AIS menggunakan <strong>Server-Sent Events (SSE)</strong> untuk mengirimkan data maritim
                    secara real-time. API ini menyediakan informasi tentang kapal, buoy, VTS, dan objek maritim lainnya
                    dalam radius 15 menit terakhir.</p>

                <div class="feature-grid">
                    <div class="feature-card">
                        <i class="fas fa-stream"></i>
                        <h4>Real-time Streaming</h4>
                        <p>Data dikirim secara kontinyu menggunakan Server-Sent Events dengan update setiap 1 menit</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-database"></i>
                        <h4>Data Terkini</h4>
                        <p>Menampilkan data AIS dari 15 menit terakhir dengan informasi posisi dan status terbaru</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-layer-group"></i>
                        <h4>Multi Object Types</h4>
                        <p>Mendukung berbagai jenis objek: Kapal, Buoy, VTS, MOB, dan Aircraft</p>
                    </div>
                    <div class="feature-card">
                        <i class="fas fa-chart-bar"></i>
                        <h4>Statistics</h4>
                        <p>Menyediakan statistik real-time tentang jumlah dan jenis objek yang terdeteksi</p>
                    </div>
                </div>
            </div>

            <div class="section">
                <h2><i class="fas fa-link"></i> Endpoint</h2>
                <div class="endpoint-box">
                    GET /api/v2/realtime
                </div>
                <div class="alert alert-info">
                    <strong><i class="fas fa-info-circle"></i> Info:</strong>
                    Endpoint ini menggunakan Server-Sent Events. Koneksi akan tetap terbuka dan mengirim data secara
                    berkala.
                </div>
            </div>
        </div>

        <!-- Quick Start Tab -->
        <div id="quickstart" class="tab-content">
            <div class="section">
                <h2><i class="fas fa-rocket"></i> Quick Start Guide</h2>

                <h3>1. JavaScript (Vanilla)</h3>
                <div class="code-block" data-language="JavaScript">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
                    <pre><code>// Inisialisasi koneksi SSE
const eventSource = new EventSource('/api/v2/realtime?limit=50');

// Handler untuk data
eventSource.onmessage = function(event) {
    const data = JSON.parse(event.data);
    console.log('Received:', data);
    
    // Update UI dengan data baru
    updateUI(data);
};

// Handler untuk koneksi terbuka
eventSource.onopen = function() {
    console.log('Connected to SSE stream');
};

// Handler untuk error
eventSource.onerror = function(error) {
    console.error('SSE Error:', error);
};</code></pre>
                </div>

                <h3>2. Fetch API (Single Request)</h3>
                <div class="code-block" data-language="JavaScript">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
                    <pre><code>// Untuk mendapatkan data sekali saja (snapshot)
fetch('/api/v2/realtime/snapshot?limit=50')
    .then(response => response.json())
    .then(data => {
        console.log('Snapshot data:', data);
        // Process data
    })
    .catch(error => {
        console.error('Error:', error);
    });</code></pre>
                </div>

                <h3>3. cURL Command</h3>
                <div class="code-block" data-language="bash">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
                    <pre><code># Streaming data dengan cURL
curl -N -H "Accept: text/event-stream" \
     "http://localhost:3000/api/v2/realtime?limit=10"

# Single request
curl "http://localhost:3000/api/v2/realtime/snapshot?limit=10"</code></pre>
                </div>

                <div class="alert alert-warning">
                    <strong><i class="fas fa-exclamation-triangle"></i> Penting:</strong>
                    Pastikan untuk menutup koneksi SSE dengan <code>eventSource.close()</code> ketika tidak diperlukan
                    lagi untuk menghindari memory leak.
                </div>
            </div>
        </div>

        <!-- Parameters Tab -->
        <div id="parameters" class="tab-content">
            <div class="section">
                <h2><i class="fas fa-cogs"></i> Query Parameters</h2>

                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Parameter</th>
                            <th>Type</th>
                            <th>Default</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>interval</code></td>
                            <td>Integer</td>
                            <td>60000</td>
                            <td>Interval update dalam milliseconds (minimum 60000 = 1 menit)</td>
                        </tr>
                        <tr>
                            <td><code>limit</code></td>
                            <td>Integer</td>
                            <td>100</td>
                            <td>Jumlah data per halaman (maksimum 500)</td>
                        </tr>
                        <tr>
                            <td><code>page</code></td>
                            <td>Integer</td>
                            <td>1</td>
                            <td>Halaman awal untuk pagination</td>
                        </tr>
                        <tr>
                            <td><code>totalLimit</code></td>
                            <td>Integer</td>
                            <td>1000</td>
                            <td>Batas maksimal total data yang akan diproses</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Contoh URL dengan Parameters</h3>
                <div class="code-block" data-language="URL">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
                    <pre><code># Basic request
/api/v2/realtime

# Custom parameters
/api/v2/realtime?limit=50&interval=60000

# High frequency (untuk testing)
/api/v2/realtime?limit=20&interval=60000</code></pre>
                </div>
            </div>
        </div>

        <!-- Response Tab -->
        <div id="response" class="tab-content">
            <div class="section">
                <h2><i class="fas fa-code"></i> Response Format</h2>

                <h3>SSE Event Structure</h3>
                <div class="code-block" data-language="JSON">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
                    <pre><code>{
  "type": "initial|update|error",
  "data": [...],
  "pagination": {
    "total": 150,
    "page": 1,
    "limit": 50,
    "totalPages": 3,
    "hasNext": true,
    "hasPrev": false
  },
  "statistics": {
    "total": 150,
    "vessels": 120,
    "buoys": 20,
    "vts": 8,
    "mob": 1,
    "aircraft": 1,
    "byMessageType": {
      "1": 80,
      "18": 40,
      "21": 20,
      "4": 8
    }
  },
  "count": 50,
  "timestamp": "2025-07-04T02:27:00.000Z",
  "timeRange": "15 minutes",
  "message": "Page 1: 50 objects loaded",
  "cached": false,
  "nextUpdate": "2025-07-04T02:28:00.000Z"
}</code></pre>
                </div>

                <h3>Data Object Structure</h3>
                <div class="code-block" data-language="JSON">
                    <button class="copy-button" onclick="copyCode(this)">Copy</button>
                    <pre><code>{
  "mmsi": 123456789,
  "timestamp": "2025-07-04T02:27:00.000Z",
  "dataAgeMinutes": 2,
  "position": {
    "latitude": -3.3194,
    "longitude": 114.5906
  },
  "movement": {
    "sog": 12.5,
    "cog": 180.0,
    "heading": 175,
    "rot": 0,
    "navStatus": 0
  },
  "static": {
    "IMO": "1234567",
    "MMSI": 123456789,
    "NAME": "VESSEL NAME",
    "TYPE": 70,
    "TYPENAME": "Cargo",
    "FLAG": "ID",
    "FLAGNAME": "Indonesia"
  },
  "objectType": "VESSEL",
  "objectCategory": "SHIP",
  "objectDescription": "Position Report Class A",
  "isVessel": true,
  "iconType": "ship",
  "NavigationStatus": "Under way using engine"
}</code></pre>
                </div>

                <h3>Object Types</h3>
                <table class="params-table">
                    <thead>
                        <tr>
                            <th>Object Type</th>
                            <th>Category</th>
                            <th>Description</th>
                            <th>Icon Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>VESSEL</code></td>
                            <td>SHIP</td>
                            <td>Kapal dengan AIS Class A/B</td>
                            <td>ship</td>
                        </tr>
                        <tr>
                            <td><code>BUOY</code></td>
                            <td>AID_TO_NAVIGATION</td>
                            <td>Pelampung navigasi</td>
                            <td>buoy</td>
                        </tr>
                        <tr>
                            <td><code>VTS</code></td>
                            <td>BASE_STATION</td>
                            <td>Vessel Traffic Service</td>
                            <td>tower</td>
                        </tr>
                        <tr>
                            <td><code>MOB</code></td>
                            <td>SEARCH_RESCUE</td>
                            <td>Man Overboard</td>
                            <td>emergency</td>
                        </tr>
                        <tr>
                            <td><code>AIRCRAFT</code></td>
                            <td>AIRCRAFT</td>
                            <td>SAR Aircraft</td>
                            <td>aircraft</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Examples Tab -->
        <div id="examples" class="tab-content">
            <div class="section">
                <h2><i class="fas fa-code-branch"></i> Framework Implementation Examples</h2>
                <p class="section-description">Implementasi lengkap untuk berbagai framework populer dengan best
                    practices dan error handling yang robust.</p>

                <!-- Framework Cards -->
                <div class="framework-grid">
                    <div class="framework-card laravel-card">
                        <div class="framework-header">
                            <div class="framework-icon">
                                <svg width="40" height="40" viewBox="0 0 256 256" fill="none">
                                    <path
                                        d="M128 0C57.3 0 0 57.3 0 128s57.3 128 128 128 128-57.3 128-128S198.7 0 128 0z"
                                        fill="#FF2D20" />
                                    <path d="M128 32c53 0 96 43 96 96s-43 96-96 96-96-43-96-96 43-96 96-96z"
                                        fill="#fff" />
                                    <path d="M128 64c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64z"
                                        fill="#FF2D20" />
                                </svg>
                            </div>
                            <div class="framework-info">
                                <h3>Laravel (PHP)</h3>
                                <span class="framework-type">Backend Framework</span>
                            </div>
                        </div>
                        <p>Service-based architecture dengan Guzzle HTTP client untuk streaming SSE dan endpoint proxy
                            yang powerful.</p>
                    </div>

                    <div class="framework-card react-card">
                        <div class="framework-header">
                            <div class="framework-icon">
                                <svg width="40" height="40" viewBox="0 0 256 256" fill="none">
                                    <circle cx="128" cy="128" r="128" fill="#61DAFB" />
                                    <circle cx="128" cy="128" r="16" fill="#000" />
                                    <ellipse cx="128" cy="128" rx="80" ry="30" stroke="#000" stroke-width="8"
                                        fill="none" />
                                    <ellipse cx="128" cy="128" rx="80" ry="30" stroke="#000" stroke-width="8"
                                        fill="none" transform="rotate(60 128 128)" />
                                    <ellipse cx="128" cy="128" rx="80" ry="30" stroke="#000" stroke-width="8"
                                        fill="none" transform="rotate(-60 128 128)" />
                                </svg>
                            </div>
                            <div class="framework-info">
                                <h3>React</h3>
                                <span class="framework-type">Frontend Library</span>
                            </div>
                        </div>
                        <p>Custom hooks dengan automatic reconnection, modern state management, dan komponen yang fully
                            responsive.</p>
                    </div>

                    <div class="framework-card angular-card">
                        <div class="framework-header">
                            <div class="framework-icon">
                                <svg width="40" height="40" viewBox="0 0 256 256" fill="none">
                                    <path d="M128 0L16 48l17.6 140.8L128 256l94.4-67.2L240 48z" fill="#DD0031" />
                                    <path d="M128 0v256l94.4-67.2L240 48z" fill="#C3002F" />
                                    <path d="M128 32L64 192h24l12.8-32h54.4L168 192h24z" fill="#fff" />
                                    <path d="M128 80l16 40h-32z" fill="#fff" />
                                </svg>
                            </div>
                            <div class="framework-info">
                                <h3>Angular</h3>
                                <span class="framework-type">Frontend Framework</span>
                            </div>
                        </div>
                        <p>Service dengan RxJS observables, TypeScript typing yang lengkap, dan reactive data handling
                            yang powerful.</p>
                    </div>
                </div>

                <!-- Laravel Implementation -->
                <div class="framework-section">
                    <div class="framework-title">
                        <div class="framework-icon-small">
                            <svg width="24" height="24" viewBox="0 0 256 256" fill="none">
                                <path d="M128 0C57.3 0 0 57.3 0 128s57.3 128 128 128 128-57.3 128-128S198.7 0 128 0z"
                                    fill="#FF2D20" />
                                <path d="M128 32c53 0 96 43 96 96s-43 96-96 96-96-43-96-96 43-96 96-96z" fill="#fff" />
                                <path d="M128 64c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64z"
                                    fill="#FF2D20" />
                            </svg>
                        </div>
                        <h3>Laravel (PHP) - Backend Service</h3>
                        <div class="framework-badges">
                            <span class="badge badge-php">PHP 8.1+</span>
                            <span class="badge badge-laravel">Laravel 10+</span>
                            <span class="badge badge-guzzle">Guzzle HTTP</span>
                        </div>
                    </div>

                    <div class="implementation-tabs">
                        <button class="impl-tab active" onclick="showImplementation('laravel-service')">Service
                            Class</button>
                        <button class="impl-tab" onclick="showImplementation('laravel-controller')">Controller</button>
                        <button class="impl-tab" onclick="showImplementation('laravel-config')">Configuration</button>
                        <button class="impl-tab" onclick="showImplementation('laravel-routes')">Routes</button>
                    </div>

                    <div id="laravel-service" class="implementation-content active">
                        <div class="code-block" data-language="PHP">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code><?php
// app/Services/AisRealtimeService.php
namespace App\Services;

use GuzzleHttp\Client;
use GuzzleHttp\Psr7\Request;
use GuzzleHttp\Exception\RequestException;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Facades\Cache;

class AisRealtimeService
{
    private $client;
    private $baseUrl;
    private $timeout;
    private $retryAttempts;
    
    public function __construct()
    {
        $this->client = new Client([
            'timeout' => 0, // No timeout for SSE
            'stream' => true,
            'verify' => false, // For development
            'headers' => [
                'User-Agent' => 'Laravel-AIS-Client/1.0',
                'Accept' => 'text/event-stream',
                'Cache-Control' => 'no-cache'
            ]
        ]);
        
        $this->baseUrl = config('ais.realtime_url', 'http://localhost:3000');
        $this->timeout = config('ais.timeout', 30);
        $this->retryAttempts = config('ais.retry_attempts', 3);
    }
    
    /**
     * Stream data dari AIS API dengan callback
     */
    public function streamData($limit = 50, $callback = null, $filters = [])
    {
        $url = $this->buildUrl('/api/v2/realtime', compact('limit') + $filters);
        
        try {
            $request = new Request('GET', $url, [
                'Accept' => 'text/event-stream',
                'Cache-Control' => 'no-cache'
            ]);
            
            Log::info("Starting SSE stream to: {$url}");
            
            $response = $this->client->send($request, ['stream' => true]);
            $body = $response->getBody();
            
            while (!$body->eof()) {
                $line = $this->readLine($body);
                
                if (strpos($line, 'data: ') === 0) {
                    $data = json_decode(substr($line, 6), true);
                    
                    if ($data && $callback) {
                        // Validate data structure
                        if ($this->validateAisData($data)) {
                            call_user_func($callback, $data);
                        } else {
                            Log::warning('Invalid AIS data received', ['data' => $data]);
                        }
                    }
                }
                
                // Handle SSE events
                if (strpos($line, 'event: ') === 0) {
                    $eventType = trim(substr($line, 7));
                    Log::debug("SSE Event received: {$eventType}");
                }
            }
            
        } catch (RequestException $e) {
            Log::error('SSE Stream error: ' . $e->getMessage());
            throw new \Exception('Failed to connect to AIS stream: ' . $e->getMessage());
        }
    }
    
    /**
     * Mendapatkan snapshot data sekali saja
     */
    public function getSnapshot($limit = 50, $useCache = true)
    {
        $cacheKey = "ais_snapshot_{$limit}";
        
        if ($useCache && Cache::has($cacheKey)) {
            return Cache::get($cacheKey);
        }
        
        $url = $this->buildUrl('/api/v2/realtime/snapshot', compact('limit'));
        
        try {
            $response = $this->client->get($url, [
                'timeout' => $this->timeout
            ]);
            
            $data = json_decode($response->getBody(), true);
            
            if ($useCache && $data) {
                Cache::put($cacheKey, $data, now()->addMinutes(1));
            }
            
            return $data;
            
        } catch (RequestException $e) {
            Log::error('Snapshot request failed: ' . $e->getMessage());
            throw new \Exception('Failed to fetch AIS snapshot: ' . $e->getMessage());
        }
    }
    
    /**
     * Mendapatkan statistik real-time
     */
    public function getStatistics()
    {
        try {
            $data = $this->getSnapshot(1, false);
            return $data['statistics'] ?? [];
        } catch (\Exception $e) {
            Log::error('Failed to get statistics: ' . $e->getMessage());
            return [];
        }
    }
    
    /**
     * Filter data berdasarkan kriteria
     */
    public function filterData($data, $filters = [])
    {
        if (empty($filters) || !isset($data['data'])) {
            return $data;
        }
        
        $filteredData = array_filter($data['data'], function ($item) use ($filters) {
            foreach ($filters as $key => $value) {
                switch ($key) {
                    case 'objectType':
                        if ($item['objectType'] !== $value) return false;
                        break;
                    case 'minSpeed':
                        if (($item['movement']['sog'] ?? 0) < $value) return false;
                        break;
                    case 'maxAge':
                        if (($item['dataAgeMinutes'] ?? 0) > $value) return false;
                        break;
                    case 'bounds':
                        $lat = $item['position']['latitude'] ?? null;
                        $lng = $item['position']['longitude'] ?? null;
                        if (!$lat || !$lng) return false;
                        if ($lat < $value['south'] || $lat > $value['north'] ||
                            $lng < $value['west'] || $lng > $value['east']) {
                            return false;
                        }
                        break;
                }
            }
            return true;
        });
        
        $data['data'] = array_values($filteredData);
        $data['count'] = count($filteredData);
        
        return $data;
    }
    
    /**
     * Validasi struktur data AIS
     */
    private function validateAisData($data)
    {
        if (!is_array($data) || !isset($data['type'])) {
            return false;
        }
        
        $requiredFields = ['type', 'timestamp'];
        foreach ($requiredFields as $field) {
            if (!isset($data[$field])) {
                return false;
            }
        }
        
        return true;
    }
    
    /**
     * Membaca satu baris dari stream
     */
    private function readLine($stream)
    {
        $line = '';
        while (!$stream->eof()) {
            $char = $stream->read(1);
            if ($char === "\n") {
                break;
            }
            $line .= $char;
        }
        return trim($line);
    }
    
    /**
     * Build URL dengan query parameters
     */
    private function buildUrl($endpoint, $params = [])
    {
        $url = rtrim($this->baseUrl, '/') . $endpoint;
        
        if (!empty($params)) {
            $url .= '?' . http_build_query($params);
        }
        
        return $url;
    }
    
    /**
     * Health check untuk koneksi AIS
     */
    public function healthCheck()
    {
        try {
            $response = $this->client->get($this->baseUrl . '/health', [
                'timeout' => 5
            ]);
            
            return $response->getStatusCode() === 200;
        } catch (\Exception $e) {
            return false;
        }
    }
}</code></pre>
                        </div>
                    </div>

                    <div id="laravel-controller" class="implementation-content">
                        <div class="code-block" data-language="PHP">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code><?php
// app/Http/Controllers/AisController.php
namespace App\Http\Controllers;

use App\Services\AisRealtimeService;
use Illuminate\Http\Request;
use Illuminate\Http\Response;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Facades\Validator;

class AisController extends Controller
{
    private $aisService;
    
    public function __construct(AisRealtimeService $aisService)
    {
        $this->aisService = $aisService;
    }
    
    /**
     * Stream real-time AIS data
     */
    public function realtime(Request $request)
    {
        $validator = Validator::make($request->all(), [
            'limit' => 'integer|min:1|max:500',
            'objectType' => 'string|in:VESSEL,BUOY,VTS,MOB,AIRCRAFT',
            'minSpeed' => 'numeric|min:0',
            'maxAge' => 'integer|min:1|max:60'
        ]);
        
        if ($validator->fails()) {
            return response()->json([
                'error' => 'Invalid parameters',
                'details' => $validator->errors()
            ], 400);
        }
        
        $limit = $request->get('limit', 50);
        $filters = $request->only(['objectType', 'minSpeed', 'maxAge']);
        
        return response()->stream(function () use ($limit, $filters) {
            // Set headers untuk SSE
            echo "retry: 10000\n";
            echo "data: " . json_encode([
                'type' => 'connected',
                'message' => 'AIS stream connected',
                'timestamp' => now()->toISOString()
            ]) . "\n\n";
            
            ob_flush();
            flush();
            
            try {
                $this->aisService->streamData($limit, function ($data) use ($filters) {
                    // Apply filters
                    if (!empty($filters)) {
                        $data = $this->aisService->filterData($data, $filters);
                    }
                    
                    // Send data to client
                    echo "data: " . json_encode($data) . "\n\n";
                    ob_flush();
                    flush();
                    
                    // Log untuk monitoring
                    Log::debug('AIS data streamed', [
                        'type' => $data['type'] ?? 'unknown',
                        'count' => $data['count'] ?? 0
                    ]);
                    
                }, $filters);
                
            } catch (\Exception $e) {
                Log::error('AIS streaming error: ' . $e->getMessage());
                
                echo "data: " . json_encode([
                    'type' => 'error',
                    'message' => 'Stream connection lost',
                    'error' => $e->getMessage(),
                    'timestamp' => now()->toISOString()
                ]) . "\n\n";
                
                ob_flush();
                flush();
            }
            
        }, 200, [
            'Content-Type' => 'text/event-stream',
            'Cache-Control' => 'no-cache',
            'Connection' => 'keep-alive',
            'X-Accel-Buffering' => 'no', // Nginx
            'Access-Control-Allow-Origin' => '*',
            'Access-Control-Allow-Headers' => 'Cache-Control'
        ]);
    }
    
    /**
     * Get snapshot data
     */
    public function snapshot(Request $request)
    {
        $validator = Validator::make($request->all(), [
            'limit' => 'integer|min:1|max:500',
            'cache' => 'boolean'
        ]);
        
        if ($validator->fails()) {
            return response()->json([
                'error' => 'Invalid parameters',
                'details' => $validator->errors()
            ], 400);
        }
        
        try {
            $limit = $request->get('limit', 50);
            $useCache = $request->get('cache', true);
            
            $data = $this->aisService->getSnapshot($limit, $useCache);
            
            return response()->json([
                'success' => true,
                'data' => $data,
                'cached' => $useCache,
                'timestamp' => now()->toISOString()
            ]);
            
        } catch (\Exception $e) {
            Log::error('AIS snapshot error: ' . $e->getMessage());
            
            return response()->json([
                'success' => false,
                'error' => 'Failed to fetch AIS data',
                'message' => $e->getMessage()
            ], 500);
        }
    }
    
    /**
     * Get statistics
     */
    public function statistics(Request $request)
    {
        try {
            $stats = $this->aisService->getStatistics();
            
            return response()->json([
                'success' => true,
                'statistics' => $stats,
                'timestamp' => now()->toISOString()
            ]);
            
        } catch (\Exception $e) {
            return response()->json([
                'success' => false,
                'error' => 'Failed to fetch statistics',
                'message' => $e->getMessage()
            ], 500);
        }
    }
    
    /**
     * Health check endpoint
     */
    public function health(Request $request)
    {
        $isHealthy = $this->aisService->healthCheck();
        
        return response()->json([
            'status' => $isHealthy ? 'healthy' : 'unhealthy',
            'service' => 'AIS Realtime API',
            'timestamp' => now()->toISOString(),
            'uptime' => $this->getUptime()
        ], $isHealthy ? 200 : 503);
    }
    
    /**
     * Get system uptime
     */
    private function getUptime()
    {
        if (function_exists('sys_getloadavg')) {
            $uptime = shell_exec('uptime');
            return trim($uptime);
        }
        
        return 'Unknown';
    }
}</code></pre>
                        </div>
                    </div>

                    <div id="laravel-config" class="implementation-content">
                        <div class="code-block" data-language="PHP">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code><?php
// config/ais.php
return [
    /*
    |--------------------------------------------------------------------------
    | AIS Realtime Configuration
    |--------------------------------------------------------------------------
    */
    
    'realtime_url' => env('AIS_REALTIME_URL', 'http://localhost:3000'),
    
    'timeout' => env('AIS_TIMEOUT', 30),
    
    'retry_attempts' => env('AIS_RETRY_ATTEMPTS', 3),
    
    'cache_ttl' => env('AIS_CACHE_TTL', 60), // seconds
    
    'rate_limit' => [
        'max_requests' => env('AIS_RATE_LIMIT_MAX', 100),
        'per_minutes' => env('AIS_RATE_LIMIT_MINUTES', 1),
    ],
    
    'filters' => [
        'max_age_minutes' => env('AIS_MAX_AGE_MINUTES', 15),
        'min_speed_knots' => env('AIS_MIN_SPEED', 0),
        'excluded_types' => explode(',', env('AIS_EXCLUDED_TYPES', '5,24')),
    ],
    
    'logging' => [
        'enabled' => env('AIS_LOGGING_ENABLED', true),
        'level' => env('AIS_LOG_LEVEL', 'info'),
        'channel' => env('AIS_LOG_CHANNEL', 'daily'),
    ],
];

// .env additions
/*
AIS_REALTIME_URL=http://localhost:3000
AIS_TIMEOUT=30
AIS_RETRY_ATTEMPTS=3
AIS_CACHE_TTL=60
AIS_RATE_LIMIT_MAX=100
AIS_RATE_LIMIT_MINUTES=1
AIS_MAX_AGE_MINUTES=15
AIS_MIN_SPEED=0
AIS_EXCLUDED_TYPES=5,24
AIS_LOGGING_ENABLED=true
AIS_LOG_LEVEL=info
AIS_LOG_CHANNEL=daily
*/</code></pre>
                        </div>
                    </div>

                    <div id="laravel-routes" class="implementation-content">
                        <div class="code-block" data-language="PHP">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code><?php
// routes/api.php
use App\Http\Controllers\AisController;
use Illuminate\Support\Facades\Route;

Route::prefix('ais')->group(function () {
    // Real-time streaming endpoint
    Route::get('/realtime', [AisController::class, 'realtime'])
        ->name('ais.realtime')
        ->middleware(['throttle:ais-stream']);
    
    // Snapshot endpoint
    Route::get('/snapshot', [AisController::class, 'snapshot'])
        ->name('ais.snapshot')
        ->middleware(['throttle:ais-api']);
    
    // Statistics endpoint
    Route::get('/statistics', [AisController::class, 'statistics'])
        ->name('ais.statistics')
        ->middleware(['throttle:ais-api']);
    
    // Health check
    Route::get('/health', [AisController::class, 'health'])
        ->name('ais.health');
});

// app/Providers/RouteServiceProvider.php - Add custom rate limiters
use Illuminate\Cache\RateLimiting\Limit;
use Illuminate\Support\Facades\RateLimiter;

public function boot()
{
    $this->configureRateLimiting();
    // ... other boot code
}

protected function configureRateLimiting()
{
    // Rate limiter untuk streaming endpoint
    RateLimiter::for('ais-stream', function (Request $request) {
        return Limit::perMinute(5)->by($request->ip());
    });
    
    // Rate limiter untuk API endpoints
    RateLimiter::for('ais-api', function (Request $request) {
        return Limit::perMinute(100)->by($request->ip());
    });
}</code></pre>
                        </div>
                    </div>
                </div>

                <!-- React Implementation -->
                <div class="framework-section">
                    <div class="framework-title">
                        <div class="framework-icon-small">
                            <svg width="24" height="24" viewBox="0 0 256 256" fill="none">
                                <circle cx="128" cy="128" r="128" fill="#61DAFB" />
                                <circle cx="128" cy="128" r="16" fill="#000" />
                                <ellipse cx="128" cy="128" rx="80" ry="30" stroke="#000" stroke-width="8" fill="none" />
                                <ellipse cx="128" cy="128" rx="80" ry="30" stroke="#000" stroke-width="8" fill="none"
                                    transform="rotate(60 128 128)" />
                                <ellipse cx="128" cy="128" rx="80" ry="30" stroke="#000" stroke-width="8" fill="none"
                                    transform="rotate(-60 128 128)" />
                            </svg>
                        </div>
                        <h3>React - Frontend Component</h3>
                        <div class="framework-badges">
                            <span class="badge badge-react">React 18+</span>
                            <span class="badge badge-hooks">Hooks</span>
                            <span class="badge badge-typescript">TypeScript</span>
                        </div>
                    </div>

                    <div class="implementation-tabs">
                        <button class="impl-tab active" onclick="showImplementation('react-hook')">Custom Hook</button>
                        <button class="impl-tab" onclick="showImplementation('react-component')">Main Component</button>
                        <button class="impl-tab" onclick="showImplementation('react-types')">TypeScript Types</button>
                        <button class="impl-tab" onclick="showImplementation('react-styles')">Styles</button>
                    </div>

                    <div id="react-hook" class="implementation-content active">
                        <div class="code-block" data-language="TypeScript">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code>// hooks/useAisRealtime.ts
import { useState, useEffect, useCallback, useRef } from 'react';

export interface AisData {
  mmsi: number;
  timestamp: string;
  dataAgeMinutes: number;
  position: {
    latitude: number;
    longitude: number;
  };
  movement: {
    sog: number;
    cog: number;
    heading: number;
    rot: number;
    navStatus: number;
  };
  static: {
    NAME: string;
    TYPE: number;
    TYPENAME: string;
    FLAG: string;
    FLAGNAME: string;
  };
  objectType: 'VESSEL' | 'BUOY' | 'VTS' | 'MOB' | 'AIRCRAFT';
  objectCategory: string;
  NavigationStatus: string;
}

export interface AisStatistics {
  total: number;
  vessels: number;
  buoys: number;
  vts: number;
  mob: number;
  aircraft: number;
  byMessageType: Record<string, number>;
}

export interface AisResponse {
  type: 'initial' | 'update' | 'error' | 'connected';
  data?: AisData[];
  statistics?: AisStatistics;
  timestamp: string;
  count?: number;
  message?: string;
  cached?: boolean;
  nextUpdate?: string;
}

export interface UseAisRealtimeOptions {
  limit?: number;
  autoReconnect?: boolean;
  maxReconnectAttempts?: number;
  reconnectDelay?: number;
  filters?: {
    objectType?: string;
    minSpeed?: number;
    maxAge?: number;
  };
}

export interface UseAisRealtimeReturn {
  data: AisData[];
  statistics: AisStatistics;
  connectionStatus: 'disconnected' | 'connecting' | 'connected' | 'error' | 'reconnecting';
  lastUpdate: Date | null;
  error: string | null;
  isLoading: boolean;
  connect: () => void;
  disconnect: () => void;
  retry: () => void;
  clearError: () => void;
}

export const useAisRealtime = (options: UseAisRealtimeOptions = {}): UseAisRealtimeReturn => {
  const {
    limit = 50,
    autoReconnect = true,
    maxReconnectAttempts = 5,
    reconnectDelay = 1000,
    filters = {}
  } = options;

  // State
  const [data, setData] = useState<AisData[]>([]);
  const [statistics, setStatistics] = useState<AisStatistics>({
    total: 0,
    vessels: 0,
    buoys: 0,
    vts: 0,
    mob: 0,
    aircraft: 0,
    byMessageType: {}
  });
  const [connectionStatus, setConnectionStatus] = useState<UseAisRealtimeReturn['connectionStatus']>('disconnected');
  const [lastUpdate, setLastUpdate] = useState<Date | null>(null);
  const [error, setError] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);

  // Refs
  const eventSourceRef = useRef<EventSource | null>(null);
  const reconnectTimerRef = useRef<NodeJS.Timeout | null>(null);
  const reconnectAttemptsRef = useRef(0);
  const mountedRef = useRef(true);

  // Build URL with filters
  const buildUrl = useCallback(() => {
    const params = new URLSearchParams({ limit: limit.toString() });
    
    Object.entries(filters).forEach(([key, value]) => {
      if (value !== undefined && value !== null) {
        params.append(key, value.toString());
      }
    });
    
    return `/api/v2/realtime?${params.toString()}`;
  }, [limit, filters]);

  // Connect function
  const connect = useCallback(() => {
    if (!mountedRef.current) return;
    
    // Close existing connection
    if (eventSourceRef.current) {
      eventSourceRef.current.close();
    }

    setConnectionStatus('connecting');
    setIsLoading(true);
    setError(null);

    try {
      const url = buildUrl();
      eventSourceRef.current = new EventSource(url);

      eventSourceRef.current.onopen = () => {
        if (!mountedRef.current) return;
        
        setConnectionStatus('connected');
        setIsLoading(false);
        setError(null);
        reconnectAttemptsRef.current = 0;
        
        console.log('🔗 AIS SSE connection established');
      };

      eventSourceRef.current.onmessage = (event) => {
        if (!mountedRef.current) return;
        
        try {
          const response: AisResponse = JSON.parse(event.data);
          
          switch (response.type) {
            case 'connected':
              console.log('✅ AIS stream connected:', response.message);
              break;
              
            case 'initial':
              if (response.data) {
                setData(response.data);
                console.log(`📊 Initial data loaded: ${response.data.length} objects`);
              }
              break;
              
            case 'update':
              if (response.data) {
                setData(response.data);
                console.log(`🔄 Data updated: ${response.data.length} objects`);
              }
              break;
              
            case 'error':
              setError(response.message || 'Server error');
              console.error('❌ Server error:', response.message);
              break;
          }

          // Update statistics and timestamp
          if (response.statistics) {
            setStatistics(response.statistics);
          }
          
          if (response.timestamp) {
            setLastUpdate(new Date(response.timestamp));
          }

        } catch (err) {
          console.error('Error parsing SSE data:', err);
          setError('Error parsing server data');
        }
      };

      eventSourceRef.current.onerror = () => {
        if (!mountedRef.current) return;
        
        console.error('❌ SSE connection error');
        setConnectionStatus('error');
        setIsLoading(false);

        if (autoReconnect && reconnectAttemptsRef.current < maxReconnectAttempts) {
          reconnectAttemptsRef.current++;
          const delay = Math.min(reconnectDelay * Math.pow(2, reconnectAttemptsRef.current - 1), 30000);
          
          setConnectionStatus('reconnecting');
          setError(`Connection lost. Retrying in ${delay/1000}s... (${reconnectAttemptsRef.current}/${maxReconnectAttempts})`);
          
          reconnectTimerRef.current = setTimeout(() => {
            if (mountedRef.current) {
              connect();
            }
          }, delay);
        } else {
          setError('Connection failed. Maximum retry attempts reached.');
        }
      };

    } catch (err) {
      console.error('Failed to create EventSource:', err);
      setError('Failed to establish connection');
      setConnectionStatus('error');
      setIsLoading(false);
    }
  }, [buildUrl, autoReconnect, maxReconnectAttempts, reconnectDelay]);

  // Disconnect function
  const disconnect = useCallback(() => {
    if (eventSourceRef.current) {
      eventSourceRef.current.close();
      eventSourceRef.current = null;
    }
    
    if (reconnectTimerRef.current) {
      clearTimeout(reconnectTimerRef.current);
      reconnectTimerRef.current = null;
    }
    
    setConnectionStatus('disconnected');
    setIsLoading(false);
    reconnectAttemptsRef.current = 0;
    
    console.log('🔌 AIS connection disconnected');
  }, []);

  // Retry function
  const retry = useCallback(() => {
    reconnectAttemptsRef.current = 0;
    connect();
  }, [connect]);

  // Clear error function
  const clearError = useCallback(() => {
    setError(null);
  }, []);

  // Auto-connect on mount
  useEffect(() => {
    connect();
    
    return () => {
      mountedRef.current = false;
      disconnect();
    };
  }, [connect, disconnect]);

  // Cleanup on unmount
  useEffect(() => {
    return () => {
      mountedRef.current = false;
      if (eventSourceRef.current) {
        eventSourceRef.current.close();
      }
      if (reconnectTimerRef.current) {
        clearTimeout(reconnectTimerRef.current);
      }
    };
  }, []);

  return {
    data,
    statistics,
    connectionStatus,
    lastUpdate,
    error,
    isLoading,
    connect,
    disconnect,
    retry,
    clearError
  };
};</code></pre>
                        </div>
                    </div>

                    <div id="react-component" class="implementation-content">
                        <div class="code-block" data-language="TypeScript">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code>// components/AisRealtimeComponent.tsx
import React, { useState, useMemo } from 'react';
import { useAisRealtime, AisData } from '../hooks/useAisRealtime';
import './AisRealtimeComponent.css';

interface AisRealtimeComponentProps {
  limit?: number;
  autoReconnect?: boolean;
  showFilters?: boolean;
  onVesselSelect?: (vessel: AisData) => void;
}

const AisRealtimeComponent: React.FC<AisRealtimeComponentProps> = ({
  limit = 50,
  autoReconnect = true,
  showFilters = true,
  onVesselSelect
}) => {
  // State
  const [selectedVessel, setSelectedVessel] = useState<AisData | null>(null);
  const [filters, setFilters] = useState({
    objectType: '',
    minSpeed: '',
    maxAge: ''
  });
  const [searchTerm, setSearchTerm] = useState('');

  // Hook
  const {
    data,
    statistics,
    connectionStatus,
    lastUpdate,
    error,
    isLoading,
    connect,
    disconnect,
    retry,
    clearError
  } = useAisRealtime({
    limit,
    autoReconnect,
    filters: {
      objectType: filters.objectType || undefined,
      minSpeed: filters.minSpeed ? Number(filters.minSpeed) : undefined,
      maxAge: filters.maxAge ? Number(filters.maxAge) : undefined
    }
  });

  // Filtered data based on search
  const filteredData = useMemo(() => {
    if (!searchTerm) return data;
    
    return data.filter(vessel => 
      vessel.mmsi.toString().includes(searchTerm) ||
      (vessel.static?.NAME || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
      vessel.objectType.toLowerCase().includes(searchTerm.toLowerCase())
    );
  }, [data, searchTerm]);

  // Status color helper
  const getStatusColor = (status: string) => {
    switch (status) {
      case 'connected': return '#27ae60';
      case 'connecting': return '#f39c12';
      case 'reconnecting': return '#e67e22';
      case 'error': return '#e74c3c';
      default: return '#95a5a6';
    }
  };

  // Format position helper
  const formatPosition = (position: AisData['position']) => {
    if (!position?.latitude || !position?.longitude) return 'Unknown';
    return `${position.latitude.toFixed(4)}, ${position.longitude.toFixed(4)}`;
  };

  // Handle vessel selection
  const handleVesselSelect = (vessel: AisData) => {
    setSelectedVessel(vessel);
    onVesselSelect?.(vessel);
  };

  // Handle filter change
  const handleFilterChange = (key: string, value: string) => {
    setFilters(prev => ({ ...prev, [key]: value }));
  };

  return (
    <div className="ais-realtime-container">
      {/* Header */}
      <div className="ais-header">
        <h2>🚢 AIS Real-time Monitor</h2>
        <div className="header-actions">
          <button 
            onClick={connectionStatus === 'connected' ? disconnect : connect}
            className={`connection-btn ${connectionStatus}`}
            disabled={isLoading}
          >
            {isLoading ? '⏳' : connectionStatus === 'connected' ? '🔌 Disconnect' : '🔗 Connect'}
          </button>
          
          {connectionStatus === 'error' && (
            <button onClick={retry} className="retry-btn">
              🔄 Retry
            </button>
          )}
        </div>
      </div>

      {/* Status Bar */}
      <div className="status-bar">
        <div className="status-indicator">
          <span 
            className="status-dot" 
            style={{ backgroundColor: getStatusColor(connectionStatus) }}
          />
          <span className="status-text">
            Status: <strong>{connectionStatus}</strong>
          </span>
        </div>
        
        {lastUpdate && (
          <div className="last-update">
            <span>Last Update: {lastUpdate.toLocaleTimeString()}</span>
          </div>
        )}
        
        <div className="data-count">
          <span>Objects: <strong>{filteredData.length}</strong></span>
        </div>
      </div>

      {/* Error Display */}
      {error && (
        <div className="error-banner">
          <span>❌ {error}</span>
          <button onClick={clearError} className="close-error">×</button>
        </div>
      )}

      {/* Filters */}
      {showFilters && (
        <div className="filters-section">
          <div className="search-box">
            <input
              type="text"
              placeholder="🔍 Search by MMSI, name, or type..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="search-input"
            />
          </div>
          
          <div className="filter-controls">
            <select
              value={filters.objectType}
              onChange={(e) => handleFilterChange('objectType', e.target.value)}
              className="filter-select"
            >
              <option value="">All Types</option>
              <option value="VESSEL">🚢 Vessels</option>
              <option value="BUOY">🛟 Buoys</option>
              <option value="VTS">📡 VTS</option>
              <option value="MOB">🆘 MOB</option>
              <option value="AIRCRAFT">✈️ Aircraft</option>
            </select>
            
            <input
              type="number"
              placeholder="Min Speed (kts)"
              value={filters.minSpeed}
              onChange={(e) => handleFilterChange('minSpeed', e.target.value)}
              className="filter-input"
              min="0"
            />
            
            <input
              type="number"
              placeholder="Max Age (min)"
              value={filters.maxAge}
              onChange={(e) => handleFilterChange('maxAge', e.target.value)}
              className="filter-input"
              min="1"
              max="60"
            />
          </div>
        </div>
      )}

      {/* Statistics Cards */}
      <div className="statistics-grid">
        <div className="stat-card total">
          <div className="stat-icon">📊</div>
          <div className="stat-content">
            <h3>{statistics.total}</h3>
            <p>Total Objects</p>
          </div>
        </div>
        
        <div className="stat-card vessels">
          <div className="stat-icon">🚢</div>
          <div className="stat-content">
            <h3>{statistics.vessels}</h3>
            <p>Vessels</p>
          </div>
        </div>
        
        <div className="stat-card buoys">
          <div className="stat-icon">🛟</div>
          <div className="stat-content">
            <h3>{statistics.buoys}</h3>
            <p>Buoys</p>
          </div>
        </div>
        
        <div className="stat-card vts">
          <div className="stat-icon">📡</div>
          <div className="stat-content">
            <h3>{statistics.vts}</h3>
            <p>VTS Stations</p>
          </div>
        </div>
      </div>

      {/* Data Table */}
      <div className="data-table-container">
        <div className="table-header">
          <h3>📋 Vessel Data ({filteredData.length} objects)</h3>
        </div>
        
        <div className="table-wrapper">
          <table className="data-table">
            <thead>
              <tr>
                <th>MMSI</th>
                <th>Name</th>
                <th>Type</th>
                <th>Speed</th>
                <th>Course</th>
                <th>Position</th>
                <th>Age</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {filteredData.length === 0 ? (
                <tr>
                  <td colSpan={8} className="no-data">
                    {isLoading ? '⏳ Loading data...' : '📭 No data available'}
                  </td>
                </tr>
              ) : (
                filteredData.map((vessel) => (
                  <tr key={vessel.mmsi} className="vessel-row">
                    <td className="mmsi-cell">{vessel.mmsi}</td>
                    <td className="name-cell">{vessel.static?.NAME || 'Unknown'}</td>
                    <td>
                      <span className={`type-badge type-${vessel.objectType.toLowerCase()}`}>
                        {vessel.objectType}
                      </span>
                    </td>
                    <td className="speed-cell">{vessel.movement?.sog || 0} kts</td>
                    <td className="course-cell">{vessel.movement?.cog || 0}°</td>
                    <td className="position-cell">{formatPosition(vessel.position)}</td>
                    <td className="age-cell">
                      <span className={`age-badge ${vessel.dataAgeMinutes > 10 ? 'old' : 'fresh'}`}>
                        {vessel.dataAgeMinutes || 0}m
                      </span>
                    </td>
                    <td>
                      <button 
                        onClick={() => handleVesselSelect(vessel)}
                        className="detail-button"
                        title="View details"
                      >
                        👁️ Details
                      </button>
                    </td>
                  </tr>
                ))
              )}
            </tbody>
          </table>
        </div>
      </div>

      {/* Vessel Detail Modal */}
      {selectedVessel && (
        <div className="modal-overlay" onClick={() => setSelectedVessel(null)}>
          <div className="modal-content" onClick={(e) => e.stopPropagation()}>
            <div className="modal-header">
              <h3>🚢 Vessel Details</h3>
              <button 
                onClick={() => setSelectedVessel(null)}
                className="close-modal"
              >
                ×
              </button>
            </div>
            
            <div className="vessel-details">
              <div className="detail-grid">
                <div className="detail-item">
                  <label>MMSI:</label>
                  <span>{selectedVessel.mmsi}</span>
                </div>
                <div className="detail-item">
                  <label>Name:</label>
                  <span>{selectedVessel.static?.NAME || 'Unknown'}</span>
                </div>
                <div className="detail-item">
                  <label>Type:</label>
                  <span className={`type-badge type-${selectedVessel.objectType.toLowerCase()}`}>
                    {selectedVessel.objectType}
                  </span>
                </div>
                <div className="detail-item">
                  <label>Speed:</label>
                  <span>{selectedVessel.movement?.sog || 0} knots</span>
                </div>
                <div className="detail-item">
                  <label>Course:</label>
                  <span>{selectedVessel.movement?.cog || 0}°</span>
                </div>
                <div className="detail-item">
                  <label>Heading:</label>
                  <span>{selectedVessel.movement?.heading || 'N/A'}°</span>
                </div>
                <div className="detail-item">
                  <label>Position:</label>
                  <span>{formatPosition(selectedVessel.position)}</span>
                </div>
                <div className="detail-item">
                  <label>Status:</label>
                  <span>{selectedVessel.NavigationStatus}</span>
                </div>
                <div className="detail-item">
                  <label>Data Age:</label>
                  <span>{selectedVessel.dataAgeMinutes || 0} minutes</span>
                </div>
                <div className="detail-item">
                  <label>Flag:</label>
                  <span>{selectedVessel.static?.FLAGNAME || 'Unknown'}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};

export default AisRealtimeComponent;</code></pre>
                        </div>
                    </div>

                    <div id="react-types" class="implementation-content">
                        <div class="code-block" data-language="TypeScript">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code>// types/ais.types.ts
export interface Position {
  latitude: number;
  longitude: number;
}

export interface Movement {
  sog: number; // Speed Over Ground
  cog: number; // Course Over Ground
  heading: number;
  rot: number; // Rate of Turn
  navStatus: number;
}

export interface StaticData {
  IMO?: string;
  MMSI: number;
  NAME?: string;
  BUILT?: string;
  FLAG?: string;
  FLAGNAME?: string;
  TYPE?: number;
  TYPENAME?: string;
  GT?: number; // Gross Tonnage
  DWT?: number; // Deadweight Tonnage
  LOA?: number; // Length Overall
  BEAM?: number;
  DRAUGHT?: number;
  CLASS?: string;
  CLASSCODE?: string;
}

export type ObjectType = 'VESSEL' | 'BUOY' | 'VTS' | 'MOB' | 'AIRCRAFT' | 'UNKNOWN';
export type ObjectCategory = 'SHIP' | 'BASE_STATION' | 'AID_TO_NAVIGATION' | 'SEARCH_RESCUE' | 'AIRCRAFT' | 'UNCLASSIFIED';
export type IconType = 'ship' | 'tower' | 'buoy' | 'emergency' | 'aircraft' | 'unknown';

export interface AisData {
  // Basic identification
  mmsi: number;
  timestamp: string;
  dataAgeMinutes: number;
  lastUpdate: string;

  // Position and movement
  position: Position;
  movement: Movement;

  // Static vessel data
  static: StaticData;

  // Object classification
  objectType: ObjectType;
  objectCategory: ObjectCategory;
  objectDescription: string;
  isVessel: boolean;
  iconType: IconType;
  messageType: number;

  // Navigation
  NavigationStatus: string;
  navstatDesk: string;
  msgDynamicDesk: string;
  vesseltypeDesk: string;

  // Coordinates (alternative format)
  coordinates: {
    type: 'Point';
    coordinates: [number, number]; // [longitude, latitude]
  };

  // Additional fields for compatibility
  MMSI: number;
  ShipName?: string;
  ShipType?: number;
  SpeedOverGround: number;
  CourseOverGround: number;
  Heading: number;
  Timestamp: string;
}

export interface AisStatistics {
  total: number;
  vessels: number;
  buoys: number;
  vts: number;
  mob: number;
  aircraft: number;
  unknown: number;
  byMessageType: Record<string, number>;
}

export interface PaginationInfo {
  total: number;
  page: number;
  limit: number;
  totalPages: number;
  hasNext: boolean;
  hasPrev: boolean;
}

export interface AisResponse {
  type: 'initial' | 'update' | 'error' | 'connected';
  data?: AisData[];
  pagination?: PaginationInfo;
  statistics?: AisStatistics;
  count?: number;
  timestamp: string;
  timeRange?: string;
  message?: string;
  cached?: boolean;
  nextUpdate?: string;
  error?: string;
}

export interface AisFilters {
  objectType?: ObjectType;
  minSpeed?: number;
  maxSpeed?: number;
  maxAge?: number;
  bounds?: {
    north: number;
    south: number;
    east: number;
    west: number;
  };
  flags?: string[];
  vesselTypes?: number[];
}

export interface ConnectionConfig {
  url?: string;
  limit?: number;
  interval?: number;
  autoReconnect?: boolean;
  maxReconnectAttempts?: number;
  reconnectDelay?: number;
  timeout?: number;
}

export type ConnectionStatus = 
  | 'disconnected' 
  | 'connecting' 
  | 'connected' 
  | 'error' 
  | 'reconnecting'
  | 'timeout';

export interface AisError {
  code: string;
  message: string;
  details?: any;
  timestamp: string;
  retryable: boolean;
}

// Event types for SSE
export interface SSEEvent {
  type: string;
  data: any;
  id?: string;
  retry?: number;
}

// Navigation status mapping
export const NAVIGATION_STATUS: Record<number, string> = {
  0: 'Under way using engine',
  1: 'At anchor',
  2: 'Not under command',
  3: 'Restricted manoeuvrability',
  4: 'Constrained by her draught',
  5: 'Moored',
  6: 'Aground',
  7: 'Engaged in fishing',
  8: 'Under way sailing',
  15: 'Undefined'
};

// Vessel type mapping
export const VESSEL_TYPES: Record<number, string> = {
  30: 'Fishing',
  31: 'Towing',
  32: 'Towing: length exceeds 200m',
  33: 'Dredging or underwater ops',
  34: 'Diving ops',
  35: 'Military ops',
  36: 'Sailing',
  37: 'Pleasure Craft',
  40: 'High speed craft (HSC)',
  50: 'Pilot Vessel',
  51: 'Search and Rescue vessel',
  52: 'Tug',
  53: 'Port Tender',
  54: 'Anti-pollution equipment',
  55: 'Law Enforcement',
  58: 'Medical Transport',
  60: 'Passenger',
  70: 'Cargo',
  80: 'Tanker',
  90: 'Other Type'
};

// Message type mapping
export const MESSAGE_TYPES: Record<number, string> = {
  1: 'Position Report Class A',
  2: 'Position Report Class A (Assigned)',
  3: 'Position Report Class A (Response)',
  4: 'Base Station Report',
  9: 'Standard SAR Aircraft Position Report',
  14: 'Safety-Related Broadcast Message',
  18: 'Standard Class B Position Report',
  21: 'Aid-to-Navigation Report'
};</code></pre>
                        </div>
                    </div>

                    <div id="react-styles" class="implementation-content">
                        <div class="code-block" data-language="CSS">
                            <button class="copy-button" onclick="copyCode(this)">Copy</button>
                            <pre><code>/* components/AisRealtimeComponent.css */
.ais-realtime-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 20px;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
  min-height: 100vh;
}

/* Header */
.ais-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 20px 30px;
  border-radius: 15px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
}

.ais-header h2 {
  margin: 0;
  color: #2c3e50;
  font-size: 1.8em;
}

.header-actions {
  display: flex;
  gap: 10px;
}

.connection-btn, .retry-btn {
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 14px;
}

.connection-btn.connected {
  background: #e74c3c;
  color: white;
}

.connection-btn.disconnected {
  background: #27ae60;
  color: white;
}

.connection-btn.connecting, .connection-btn.reconnecting {
  background: #f39c12;
  color: white;
}

.connection-btn.error {
  background: #e74c3c;
  color: white;
}

.retry-btn {
  background: #3498db;
  color: white;
}

.connection-btn:hover, .retry-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* Status Bar */
.status-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 15px 25px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
}

.status-indicator {
  display: flex;
  align-items: center;
  gap: 10px;
}

.status-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { opacity: 1; }
  50% { opacity: 0.5; }
  100% { opacity: 1; }
}

.status-text {
  font-weight: 500;
  color: #2c3e50;
}

.last-update, .data-count {
  color: #7f8c8d;
  font-size: 14px;
}

/* Error Banner */
.error-banner {
  background: #e74c3c;
  color: white;
  padding: 15px 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  animation: slideDown 0.3s ease;
}

@keyframes slideDown {
  from { transform: translateY(-100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

.close-error {
  background: none;
  border: none;
  color: white;
  font-size: 20px;
  cursor: pointer;
  padding: 0;
  width: 24px;
  height: 24px;
}

/* Filters Section */
.filters-section {
  background: white;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  margin-bottom: 20px;
}

.search-box {
  margin-bottom: 15px;
}

.search-input {
  width: 100%;
  padding: 12px 16px;
  border: 2px solid #ecf0f1;
  border-radius: 8px;
  font-size: 16px;
  transition: border-color 0.3s ease;
}

.search-input:focus {
  outline: none;
  border-color: #3498db;
}

.filter-controls {
  display: flex;
  gap: 15px;
  flex-wrap: wrap;
}

.filter-select, .filter-input {
  padding: 10px 12px;
  border: 2px solid #ecf0f1;
  border-radius: 6px;
  font-size: 14px;
  min-width: 150px;
}

.filter-select:focus, .filter-input:focus {
  outline: none;
  border-color: #3498db;
}

/* Statistics Grid */
.statistics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.stat-card {
  background: white;
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 20px;
  transition: transform 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-5px);
}

.stat-icon {
  font-size: 2.5em;
  opacity: 0.8;
}

.stat-content h3 {
  margin: 0;
  font-size: 2.2em;
  font-weight: bold;
  color: #2c3e
}
        
        <div class="footer">
            <p><strong>AIS Realtime API v2.0</strong></p>
            <p>Developed with ❤️ for Maritime Industry</p>
            <p style="margin-top: 15px; color: #666;">
                <i class="fas fa-clock"></i> Last Updated: July 2025 | 
                <i class="fas fa-code"></i> Server-Sent Events | 
                <i class="fas fa-shield-alt"></i> Production Ready
            </p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        function copyCode(button) {
            const codeBlock = button.nextElementSibling.querySelector('code');
            const text = codeBlock.textContent;

            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.background = '#27ae60';

                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = '#667eea';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
            });
        }

        // Initialize Prism for syntax highlighting
        Prism.highlightAll();
    </script>
</body>
</html>